import*as THREE from"three";export class HexMeshFactory{constructor(){this.radius=2;this.height=.5;this.geometry=this.createHexGeometry(this.radius,this.height);this.materials=new Map}createHexGeometry(radius,height){const shape=new THREE.Shape;const sides=6;for(let i=0;i<sides;i++){const angle=i*Math.PI*2/sides;const x=Math.cos(angle)*radius;const y=Math.sin(angle)*radius;if(i===0){shape.moveTo(x,y)}else{shape.lineTo(x,y)}}const extrudeSettings={steps:1,depth:height,bevelEnabled:true,bevelThickness:.1,bevelSize:.1,bevelSegments:2};const geometry=new THREE.ExtrudeGeometry(shape,extrudeSettings);geometry.rotateX(-Math.PI/2);return geometry}getMaterial(terrainType){if(!this.materials.has(terrainType)){let color=8947848;switch(terrainType){case"plains":color=4906624;break;case"forest":color=1467700;break;case"hills":color=14251782;break;case"mountains":color=5722958;break;case"water":color=3900150;break;case"wasteland":color=8330525;break;case"desert":color=16638023;break}const material=new THREE.MeshStandardMaterial({color:color,roughness:.8,metalness:.1,flatShading:true});this.materials.set(terrainType,material)}return this.materials.get(terrainType)}createHexMesh(hex){const material=this.getMaterial(hex.terrain);const mesh=new THREE.Mesh(this.geometry,material);mesh.userData={type:"hex",q:hex.q,r:hex.r};mesh.receiveShadow=true;mesh.castShadow=true;const size=this.radius*1.05;const x=size*1.5*hex.q;const z=size*Math.sqrt(3)*(hex.r+hex.q/2);mesh.position.set(x,0,z);this.addProps(mesh,hex.terrain);if(hex.site){this.addSiteMarker(mesh,hex.site)}return mesh}addProps(parentMesh,terrain){switch(terrain){case"mountains":this.addMountainProp(parentMesh);break;case"forest":this.addForestProp(parentMesh);break;case"hills":this.addHillProp(parentMesh);break}}addMountainProp(parentMesh){const group=new THREE.Group;const material=new THREE.MeshStandardMaterial({color:7041664,roughness:.9,flatShading:true});const mainPeak=new THREE.Mesh(new THREE.ConeGeometry(.8,2.2,4),material);mainPeak.position.set(0,1.1,0);group.add(mainPeak);const sidePeak1=new THREE.Mesh(new THREE.ConeGeometry(.6,1.5,4),material);sidePeak1.position.set(.6,.75,.4);sidePeak1.rotation.y=Math.PI/4;group.add(sidePeak1);const sidePeak2=new THREE.Mesh(new THREE.ConeGeometry(.5,1.2,4),material);sidePeak2.position.set(-.5,.6,-.5);sidePeak2.rotation.y=-Math.PI/6;group.add(sidePeak2);parentMesh.add(group)}addForestProp(parentMesh){const group=new THREE.Group;const trunkGeo=new THREE.CylinderGeometry(.1,.1,.4,6);const trunkMat=new THREE.MeshStandardMaterial({color:4532128});const foliageGeo=new THREE.ConeGeometry(.4,1,6);const foliageMat=new THREE.MeshStandardMaterial({color:1467700,flatShading:true});const createTree=(x,z,scale=1)=>{const tree=new THREE.Group;const trunk=new THREE.Mesh(trunkGeo,trunkMat);trunk.position.y=.2;tree.add(trunk);const foliage=new THREE.Mesh(foliageGeo,foliageMat);foliage.position.y=.8;tree.add(foliage);tree.position.set(x,0,z);tree.scale.set(scale,scale,scale);group.add(tree)};createTree(0,0,1.2);createTree(.6,.5,.9);createTree(-.5,.4,.85);createTree(.3,-.6,1.1);createTree(-.4,-.5,.7);parentMesh.add(group)}addHillProp(parentMesh){const geo=new THREE.SphereGeometry(.8,8,8,0,Math.PI*2,0,Math.PI/2);const mat=new THREE.MeshStandardMaterial({color:14251782,flatShading:true});const createHill=(x,z,scale)=>{const hill=new THREE.Mesh(geo,mat);hill.position.set(x,.1,z);hill.scale.set(scale,scale*.5,scale);parentMesh.add(hill)};createHill(.4,.3,1);createHill(-.3,-.4,.8)}updateSiteMarkers(parentMesh,_site){const markerGroup=new THREE.Group;markerGroup.name="site-marker";const geo=new THREE.OctahedronGeometry(.6);const mat=new THREE.MeshStandardMaterial({color:15680580,emissive:10033947,emissiveIntensity:.5,metalness:.8,roughness:.2});const marker=new THREE.Mesh(geo,mat);marker.position.set(0,2.5,0);markerGroup.add(marker);parentMesh.add(markerGroup)}addSiteMarker(parentMesh,site){this.updateSiteMarkers(parentMesh,site)}}