import{animator}from"./animator.js";import ParticleSystem from"./particles.js";export function triggerScreenShake(intensity=5,duration=300){return new Promise(resolve=>{const container=document.querySelector(".game-container");if(!container){resolve();return}const startTime=performance.now();let animationFrame;function shake(currentTime){const progress=(currentTime-startTime)/duration;if(progress>=1){container.style.transform="";cancelAnimationFrame(animationFrame);resolve();return}const currentIntensity=intensity*(1-progress);const x=(Math.random()-.5)*currentIntensity*2;const y=(Math.random()-.5)*currentIntensity*2;const rotate=(Math.random()-.5)*currentIntensity*.5;container.style.transform=`translate(${x}px, ${y}px) rotate(${rotate}deg)`;animationFrame=requestAnimationFrame(shake)}animationFrame=requestAnimationFrame(shake)})}export function animateHealthBar(element,from,to,max){return new Promise(resolve=>{if(!element){resolve();return}const fromPercent=from/max*100;const toPercent=to/max*100;animator.animate({from:fromPercent,to:toPercent,duration:500,easing:"easeOutQuad",onUpdate:value=>{element.style.width=`${value}%`;if(value>60){element.style.background="linear-gradient(90deg, #10b981, #059669)"}else if(value>30){element.style.background="linear-gradient(90deg, #fbbf24, #f59e0b)"}else{element.style.background="linear-gradient(90deg, #ef4444, #dc2626)"}},onComplete:resolve});if(to<from){element.style.animation="healthFlash 0.3s ease-in-out";setTimeout(()=>{element.style.animation=""},300)}})}export function showVictorySplash(){return new Promise(resolve=>{const splash=document.createElement("div");splash.className="victory-splash";splash.innerHTML=`\n            <div class="victory-content">\n                <div class="victory-icon">üèÜ</div>\n                <h1 class="victory-title">SIEG!</h1>\n                <p class="victory-subtitle">Feind besiegt!</p>\n            </div>\n        `;document.body.appendChild(splash);triggerConfetti();setTimeout(()=>{splash.style.opacity="0";setTimeout(()=>{splash.remove();resolve()},500)},2e3)})}export function showDefeatOverlay(){return new Promise(resolve=>{const overlay=document.createElement("div");overlay.className="defeat-overlay";overlay.innerHTML=`\n            <div class="defeat-content">\n                <div class="defeat-icon">üíî</div>\n                <h1 class="defeat-title">VERLETZT</h1>\n                <p class="defeat-subtitle">Du wurdest getroffen...</p>\n            </div>\n        `;document.body.appendChild(overlay);setTimeout(()=>{overlay.style.opacity="0";setTimeout(()=>{overlay.remove();resolve()},500)},1500)})}export function animateImpact(x,y,color="#ef4444",particleSystem){const flash=document.createElement("div");flash.className="combat-impact-flash";flash.style.left=`${x}px`;flash.style.top=`${y}px`;flash.style.background=`radial-gradient(circle, ${color} 0%, transparent 70%)`;document.body.appendChild(flash);setTimeout(()=>flash.remove(),500);if(particleSystem){particleSystem.impactEffect(x,y,color)}triggerScreenShake(3,200)}export function animateBlock(x,y,particleSystem){const shield=document.createElement("div");shield.className="combat-block-effect";shield.style.left=`${x}px`;shield.style.top=`${y}px`;shield.innerHTML="üõ°Ô∏è";document.body.appendChild(shield);setTimeout(()=>shield.remove(),800);if(particleSystem){particleSystem.burst(x,y,20,{color:"#3b82f6",size:3,speed:2,decay:.02,type:"star"})}}function triggerConfetti(){const canvas=document.getElementById("game-board");if(!canvas)return;const particleSystem=new ParticleSystem(canvas);const colors=["#fbbf24","#ec4899","#8b5cf6","#10b981","#3b82f6"];const centerX=canvas.width/2;const centerY=canvas.height/2;for(let i=0;i<5;i++){setTimeout(()=>{colors.forEach(color=>{particleSystem.explosion(centerX+(Math.random()-.5)*200,centerY+(Math.random()-.5)*100,color,15)})},i*200)}}export function pulseElement(element,color="#8b5cf6"){if(!element)return;element.style.animation="elementPulse 0.5s ease-in-out";element.style.setProperty("--pulse-color",color);setTimeout(()=>{element.style.animation=""},500)}export function flashDamageNumber(x,y,damage,color="#ef4444"){const numberEl=document.createElement("div");numberEl.className="damage-number";numberEl.textContent=`-${damage}`;numberEl.style.left=`${x}px`;numberEl.style.top=`${y}px`;numberEl.style.color=color;document.body.appendChild(numberEl);setTimeout(()=>numberEl.remove(),1e3)}export function enemyDefeatedExplosion(x,y,particleSystem){if(particleSystem){particleSystem.explosion(x,y,"#fbbf24",40);setTimeout(()=>{particleSystem.explosion(x,y,"#ec4899",30)},150)}triggerScreenShake(7,400)}export default{triggerScreenShake:triggerScreenShake,animateHealthBar:animateHealthBar,showVictorySplash:showVictorySplash,showDefeatOverlay:showDefeatOverlay,animateImpact:animateImpact,animateBlock:animateBlock,pulseElement:pulseElement,flashDamageNumber:flashDamageNumber,enemyDefeatedExplosion:enemyDefeatedExplosion};