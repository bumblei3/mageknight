import{SaveManager}from"../persistence/SaveManager.js";export class GameStateManager{constructor(game){this.game=game}saveGame(slotId){try{const state=this.getGameState();const success=SaveManager.saveGame(`slot_${slotId}`,state);if(success){this.game.showToast(`Spiel in Slot ${slotId+1} gespeichert`,"success")}else{this.game.showToast("Speichern fehlgeschlagen","error")}}catch(e){console.error("Save failed",e);this.game.showToast("Speichern fehlgeschlagen","error")}}loadGame(slotId){const state=SaveManager.loadGame(`slot_${slotId}`);if(state){return this.loadGameState(state)}return false}getGameState(){return{hero:this.game.hero?this.game.hero.getState():null,enemies:this.game.entityManager.enemies.map(e=>e.getState()),hexGrid:this.game.hexGrid.getState(),time:this.game.timeManager.getState(),statistics:this.game.statisticsManager.getState(),achievements:this.game.achievementManager.getState(),turn:this.game.turnManager.getState(),timestamp:Date.now()}}loadGameState(state){if(!state)return false;try{if(state.hero&&this.game.hero){this.game.hero.loadState(state.hero)}if(state.enemies){this.game.entityManager.enemies=state.enemies.map(eData=>{const e=this.game.enemyAI.reconstituteEnemy(eData);return e});this.game.enemies=this.game.entityManager.enemies}if(state.hexGrid)this.game.hexGrid.loadState(state.hexGrid);if(state.time)this.game.timeManager.loadState(state.time);if(state.statistics)this.game.statisticsManager.loadState(state.statistics);if(state.achievements)this.game.achievementManager.loadState(state.achievements);if(state.turn)this.game.turnManager.loadState(state.turn);this.game.updateStats();this.game.updateTimeUI();this.game.updatePhaseIndicator();this.game.render();return true}catch(e){console.error("Load failed",e);return false}}openSaveDialog(){let message="ðŸ’¾ SPIEL SPEICHERN\n\nWÃ¤hle einen Slot (1-5):\n";for(let i=0;i<5;i++){const meta=SaveManager.getSaveMeta(`slot_${i}`);if(meta){message+=`Slot ${i+1}: ${new Date(meta.timestamp).toLocaleString()}\n`}else{message+=`Slot ${i+1}: [Leer]\n`}}const slot=prompt(message);if(slot&&slot>=1&&slot<=5){this.saveGame(parseInt(slot)-1)}}openLoadDialog(){let message="ðŸ“‚ SPIELSTAND LADEN\n\n";for(let i=0;i<5;i++){const meta=SaveManager.getSaveMeta(`slot_${i}`);if(meta){message+=`Slot ${i+1}: ${new Date(meta.timestamp).toLocaleString()}\n`}else{message+=`Slot ${i+1}: [Leer]\n`}}message+="\nWÃ¤hle Slot (1-5) oder Abbrechen:";const slot=prompt(message);if(slot&&slot>=1&&slot<=5){const state=SaveManager.loadGame(`slot_${parseInt(slot)-1}`);if(state){this.loadGameState(state);this.game.showToast("Spiel geladen!","success")}else{this.game.addLog("Fehler beim Laden","info");this.game.showToast("Fehler beim Laden","error")}}}}