import{HexGridLogic}from"./hexgrid/HexGridLogic.js";import{HexGridRenderer}from"./hexgrid/HexGridRenderer.js";export class HexGrid{constructor(canvas){this.canvas=canvas;this.ctx=canvas.getContext("2d");this.logic=new HexGridLogic(40);this.renderer=new HexGridRenderer(canvas,this.logic);this.hexSize=this.logic.hexSize;this.hexes=this.logic.hexes;this.debugMode=false}setTerrainSystem(terrainSystem){this.logic.setTerrainSystem(terrainSystem)}axialToPixel(q,r){return this.renderer.axialToPixel(q,r)}getScreenPos(q,r){return this.axialToPixel(q,r)}pixelToAxial(x,y){return this.renderer.pixelToAxial(x,y)}roundAxial(q,r){return this.logic.roundAxial(q,r)}getNeighbors(q,r){return this.logic.getNeighbors(q,r)}distance(q1,r1,q2,r2){return this.logic.distance(q1,r1,q2,r2)}getHexesInRange(q,r,range){return this.logic.getHexesInRange(q,r,range)}getReachableHexes(startPos,movementPoints,isDay,hasFlight=false){return this.logic.getReachableHexes(startPos,movementPoints,isDay,hasFlight)}getMovementCost(q,r,isNight=false,hasFlight=false){if(hasFlight)return 1;const hex=this.getHex(q,r);if(!hex)return 999;if(this.logic.terrainSystem){return this.logic.terrainSystem.getMovementCost(hex.terrain,isNight)}const costs={plains:2,forest:3,hills:3,mountains:5,desert:5,wasteland:3,water:999};const cost=costs[hex.terrain]||2;if(isNight){if(hex.terrain==="forest")return 5;if(hex.terrain==="desert")return 3}return cost}getHexKey(q,r){return this.logic.getHexKey(q,r)}setHex(q,r,data){this.logic.setHex(q,r,data)}getHex(q,r){return this.logic.getHex(q,r)}hasHex(q,r){return this.logic.hasHex(q,r)}exploreAdjacent(center){const neighbors=this.getNeighbors(center.q,center.r);const newHexes=[];neighbors.forEach(n=>{const key=this.getHexKey(n.q,n.r);if(this.hexes.has(key)){const hex=this.hexes.get(key);if(!hex.revealed){hex.revealed=true;this.hexes.set(key,hex);newHexes.push(hex)}}else{const newHex={q:n.q,r:n.r,revealed:true,terrain:this.getRandomTerrain()};this.hexes.set(key,newHex);newHexes.push(newHex)}});return newHexes}getRandomTerrain(){const terrains=["plains","forest","hills","mountains","desert","wasteland"];return terrains[Math.floor(Math.random()*terrains.length)]}setTimeOfDay(isNight){this.renderer.setTimeOfDay(isNight)}highlightHexes(hexList){this.renderer.highlightHexes(hexList)}clearHighlights(){this.renderer.clearHighlights()}selectHex(q,r){this.renderer.selectHex(q,r)}clearSelection(){this.renderer.clearSelection()}clear(){this.renderer.clear()}render(hero=null,enemies=[]){this.renderer.debugMode=this.debugMode;this.renderer.render(hero,enemies)}drawHex(q,r,options={}){this.renderer.drawHex(q,r,options)}drawHexText(q,r,text,options={}){this.renderer.drawHexText(q,r,text,options)}drawHexIcon(q,r,icon,offsetY=0){this.renderer.drawHexIcon(q,r,icon,offsetY)}getTerrainColor(terrain){return this.renderer.getTerrainColor(terrain)}getTerrainIcon(terrain){return this.renderer.getTerrainIcon(terrain)}getState(){return{hexes:Array.from(this.hexes.entries()),selectedHex:this.renderer.selectedHex,ambientLight:this.renderer.ambientLight}}loadState(state){if(!state)return;if(state.hexes){this.logic.hexes=new Map(state.hexes);this.hexes=this.logic.hexes}this.renderer.selectedHex=state.selectedHex||null;this.renderer.ambientLight=state.ambientLight!==undefined?state.ambientLight:1}get selectedHex(){return this.renderer.selectedHex}set selectedHex(val){this.renderer.selectedHex=val}get highlightedHexes(){return this.renderer.highlightedHexes}get ambientLight(){return this.renderer.ambientLight}set ambientLight(val){this.renderer.ambientLight=val}get heroPosition(){return this.renderer.heroPosition}set heroPosition(val){this.renderer.heroPosition=val}get visionRadius(){return this.renderer.visionRadius}set visionRadius(val){this.renderer.visionRadius=val}get animationFrame(){return this.renderer.animationFrame}set animationFrame(val){this.renderer.animationFrame=val}}