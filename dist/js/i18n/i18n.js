import{store,ACTIONS}from"../game/Store.js";let currentLanguage="de";const translations={};export function registerLanguage(lang,dict){translations[lang]=dict}export function setLanguage(lang){if(translations[lang]){currentLanguage=lang;localStorage.setItem("mageknightLang",lang);if(store){store.dispatch(ACTIONS.SET_LANGUAGE,lang)}if(typeof window!=="undefined"){window.dispatchEvent(new CustomEvent("languageChanged",{detail:lang}))}return true}return false}export function getLanguage(){return currentLanguage}export function getAvailableLanguages(){return Object.keys(translations)}export function t(key,params={}){const dict=translations[currentLanguage];if(!dict)return key;const value=key.split(".").reduce((obj,k)=>obj?.[k],dict);if(value===undefined){const fallback=key.split(".").reduce((obj,k)=>obj?.[k],translations["de"]);if(fallback!==undefined){return interpolate(fallback,params)}return key}return interpolate(value,params)}function interpolate(str,params){if(typeof str!=="string")return str;return str.replace(/\{(\w+)\}/g,(_,key)=>params[key]??`{${key}}`)}export function initI18n(){const savedLang=typeof localStorage!=="undefined"?localStorage.getItem("mageknightLang"):null;if(savedLang&&translations[savedLang]){currentLanguage=savedLang;return}if(typeof navigator!=="undefined"){const browserLang=navigator.language?.split("-")[0];if(browserLang&&translations[browserLang]){currentLanguage=browserLang;return}}currentLanguage="de"}export function updateElement(element){const key=element.getAttribute("data-i18n");if(!key)return;const translation=t(key);if(element.hasAttribute("title")){const titleKey=element.getAttribute("data-i18n-title");if(titleKey){element.setAttribute("title",t(titleKey))}}if(element.tagName==="INPUT"||element.tagName==="TEXTAREA"){if(element.hasAttribute("placeholder")){element.setAttribute("placeholder",translation)}}else{element.textContent=translation}}export function translateDocument(){const elements=document.querySelectorAll("[data-i18n]");elements.forEach(updateElement);const titleKey=document.querySelector("title")?.getAttribute("data-i18n");if(titleKey){document.title=t(titleKey)}}export default{t:t,setLanguage:setLanguage,getLanguage:getLanguage,registerLanguage:registerLanguage,getAvailableLanguages:getAvailableLanguages,initI18n:initI18n,translateDocument:translateDocument,updateElement:updateElement};