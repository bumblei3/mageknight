import{MageKnightGame}from"./game.js";import{Game3D}from"./3d/Game3D.js";import i18n from"./i18n/index.js";import{ErrorHandler}from"./errorHandler.js";window.i18n=i18n;let errorHandler=null;const updateLoading=(progress,status)=>{const progressBar=document.getElementById("loading-progress");const statusText=document.getElementById("loading-status");if(progressBar)progressBar.style.width=`${progress}%`;if(statusText)statusText.textContent=status};const hideLoadingScreen=()=>{const loadingScreen=document.getElementById("loading-screen");if(loadingScreen){loadingScreen.classList.add("hidden");setTimeout(()=>{loadingScreen.remove()},600)}};const startMageKnight=async()=>{if(window.game){console.warn("Mage Knight already initialized. Skipping.");hideLoadingScreen();return}console.log("Starting Mage Knight...");try{updateLoading(20,"Lade Spielressourcen...");await new Promise(r=>setTimeout(r,100));updateLoading(40,"Initialisiere Spielwelt...");await new Promise(r=>setTimeout(r,100));window.game=new MageKnightGame;try{window.game3D=new Game3D(window.game);window.game3D.init("game-container-3d");document.getElementById("toggle-3d-btn").addEventListener("click",()=>{const isEnabled=window.game3D.toggle();const btn=document.getElementById("toggle-3d-btn");btn.classList.toggle("active",isEnabled);if(isEnabled){btn.style.backgroundColor="var(--primary-color)"}else{btn.style.backgroundColor=""}});const originalUpdateStats=window.game.updateStats.bind(window.game);window.game.updateStats=()=>{originalUpdateStats();if(window.game3D&&window.game3D.enabled){window.game3D.update()}}}catch(e){console.warn("3D initialization failed:",e)}updateLoading(70,"Lade Karten und Einheiten...");await new Promise(r=>setTimeout(r,150));updateLoading(90,"Bereite HUD vor...");await new Promise(r=>setTimeout(r,100));console.log("Game initialized successfully!");if(window.game.debugManager){window.debug=window.game.debugManager}errorHandler=new ErrorHandler(window.game);window.errorHandler=errorHandler;updateLoading(100,"Fertig!");await new Promise(r=>setTimeout(r,300));hideLoadingScreen()}catch(error){console.error("Failed to initialize game:",error);updateLoading(0,"Fehler beim Laden!")}};if(document.readyState==="loading"){window.addEventListener("load",startMageKnight,{once:true})}else{requestAnimationFrame(startMageKnight)}