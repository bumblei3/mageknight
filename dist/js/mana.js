export const MANA_COLORS={RED:"red",BLUE:"blue",WHITE:"white",GREEN:"green",GOLD:"gold",BLACK:"black"};export class ManaSource{constructor(playerCount=1){this.playerCount=playerCount;this.dice=[];this.usedDice=new Set;this.initialize()}initialize(){const diceCount=this.playerCount+2;this.dice=[];this.usedDice.clear();for(let i=0;i<diceCount;i++){this.dice.push(this.rollDie())}this.ensureBasicColors()}rollDie(){const colors=[MANA_COLORS.RED,MANA_COLORS.BLUE,MANA_COLORS.WHITE,MANA_COLORS.GREEN,MANA_COLORS.GOLD,MANA_COLORS.BLACK];return colors[Math.floor(Math.random()*colors.length)]}ensureBasicColors(){const basicColors=[MANA_COLORS.RED,MANA_COLORS.BLUE,MANA_COLORS.WHITE,MANA_COLORS.GREEN];const basicIndices=[];const nonBasicIndices=[];this.dice.forEach((color,idx)=>{if(basicColors.includes(color)){basicIndices.push(idx)}else{nonBasicIndices.push(idx)}});const requiredBasic=Math.ceil(this.dice.length/2);let currentBasicCount=basicIndices.length;if(currentBasicCount<requiredBasic){for(let i=nonBasicIndices.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[nonBasicIndices[i],nonBasicIndices[j]]=[nonBasicIndices[j],nonBasicIndices[i]]}while(currentBasicCount<requiredBasic&&nonBasicIndices.length>0){const idx=nonBasicIndices.pop();this.dice[idx]=basicColors[Math.floor(Math.random()*basicColors.length)];currentBasicCount++}}}takeDie(index,isNight=false){if(this.isDieAvailable(index,isNight)){this.usedDice.add(index);return this.dice[index]}return null}isDieAvailable(index,isNight=false){if(index<0||index>=this.dice.length||this.usedDice.has(index)){return false}const color=this.dice[index];if(isNight&&color===MANA_COLORS.GOLD)return false;if(!isNight&&color===MANA_COLORS.BLACK)return false;return true}returnDice(){this.usedDice.forEach(index=>{this.dice[index]=this.rollDie()});this.usedDice.clear();this.ensureBasicColors()}getAvailableDice(isNight=false){return this.dice.map((color,index)=>({index:index,color:color,available:this.isDieAvailable(index,isNight)}))}getDiceByColor(color){return this.dice.map((c,index)=>({color:c,index:index})).filter(d=>d.color===color&&!this.usedDice.has(d.index))}hasColor(color){return this.getDiceByColor(color).length>0}getState(){return{dice:[...this.dice],usedDice:Array.from(this.usedDice)}}loadState(state){if(!state)return;this.dice=[...state.dice||[]];this.usedDice=new Set(state.usedDice||[])}}export class CrystalStorage{constructor(){this.crystals={[MANA_COLORS.RED]:0,[MANA_COLORS.BLUE]:0,[MANA_COLORS.WHITE]:0,[MANA_COLORS.GREEN]:0};this.maxPerColor=3}addCrystal(color){if(this.crystals[color]!==undefined&&this.crystals[color]<this.maxPerColor){this.crystals[color]++;return true}return false}useCrystal(color){if(this.crystals[color]>0){this.crystals[color]--;return true}return false}getCount(color){return this.crystals[color]||0}hasColor(color){return this.getCount(color)>0}getAll(){return{...this.crystals}}}export default ManaSource;