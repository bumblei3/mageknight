export class SoundManager{constructor(){this.ctx=null;this.enabled=false;this.masterVolume=1;this.timeouts=new Set;this.init()}init(){if(this.ctx&&this.ctx.state!=="closed")return;try{this.ctx=new(window.AudioContext||window.webkitAudioContext);this.enabled=true}catch(e){console.warn("Web Audio API not supported:",e);this.enabled=false}}toggle(){this.enabled=!this.enabled;return this.enabled}setVolume(vol){this.masterVolume=Math.max(0,Math.min(1,vol))}playTone(frequency,duration,type="sine",volume=.1){if(!this.enabled||!this.ctx||this.ctx.state==="closed")return;try{const oscillator=this.ctx.createOscillator();const gainNode=this.ctx.createGain();oscillator.type=type;oscillator.frequency.value=frequency;gainNode.gain.setValueAtTime(volume*this.masterVolume,this.ctx.currentTime);gainNode.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+duration);oscillator.connect(gainNode);gainNode.connect(this.ctx.destination);oscillator.start();oscillator.stop(this.ctx.currentTime+duration)}catch(e){console.warn("Failed to play tone:",e.message)}}playChord(frequencies,duration,type="sine"){frequencies.forEach((freq,i)=>{setTimeout(()=>this.playTone(freq,duration,type),i*30)})}playNoise(duration,filterFreq=1e3){if(!this.enabled||!this.audioContext){this.init();if(!this.audioContext)return}const bufferSize=this.audioContext.sampleRate*duration;const buffer=this.audioContext.createBuffer(1,bufferSize,this.audioContext.sampleRate);const data=buffer.getChannelData(0);for(let i=0;i<bufferSize;i++){data[i]=Math.random()*2-1}const noise=this.audioContext.createBufferSource();noise.buffer=buffer;const gainNode=this.audioContext.createGain();gainNode.gain.setValueAtTime(.3,this.audioContext.currentTime);gainNode.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+duration);if(this.audioContext.createBiquadFilter){const filter=this.audioContext.createBiquadFilter();filter.type="lowpass";filter.frequency.value=filterFreq;noise.connect(filter);filter.connect(gainNode)}else{noise.connect(gainNode)}gainNode.connect(this.masterGain);noise.start();noise.stop(this.audioContext.currentTime+duration)}cardDraw(){this.playTone(800,.08,"sine");setTimeout(()=>this.playTone(1e3,.05,"sine"),40)}cardPlay(){this.playTone(400,.1,"triangle");this.playTone(600,.15,"triangle")}cardPlayStrong(){this.playChord([400,500,600],.2,"sawtooth");setTimeout(()=>this.playTone(800,.15,"sine"),100)}cardPlaySideways(){this.playTone(300,.15,"triangle")}move(){this.playTone(200,.08,"sine");const t=setTimeout(()=>{this.playTone(250,.06,"sine");this.timeouts.delete(t)},50);this.timeouts.add(t)}attack(){this.playNoise(.15,800);this.playTone(150,.2,"sawtooth")}hit(){this.playNoise(.1,600);this.playTone(100,.15,"square");const t=setTimeout(()=>{this.playTone(80,.1,"square");this.timeouts.delete(t)},80);this.timeouts.add(t)}block(){this.playTone(300,.1,"triangle");this.playTone(400,.1,"triangle");this.playNoise(.05,2e3)}victory(){const notes=[523,659,784,1047];notes.forEach((freq,i)=>{const t=setTimeout(()=>{this.playTone(freq,.3,"sine");this.timeouts.delete(t)},i*150);this.timeouts.add(t)})}destroy(){this.timeouts.forEach(t=>clearTimeout(t));this.timeouts.clear();if(this.ctx&&this.ctx.state!=="closed"){try{this.ctx.close()}catch(_e){}}}defeat(){const notes=[300,250,200,150];notes.forEach((freq,i)=>{setTimeout(()=>this.playTone(freq,.4,"sawtooth"),i*200)})}levelUp(){this.playChord([523,659,784],.3,"sine");setTimeout(()=>this.playChord([587,740,880],.4,"sine"),200)}error(){this.playTone(200,.15,"square");setTimeout(()=>this.playTone(150,.2,"square"),100)}notification(){this.playTone(880,.1,"sine");setTimeout(()=>this.playTone(1100,.15,"sine"),80)}manaUse(){this.playTone(600,.1,"sine");this.playTone(900,.15,"sine")}explore(){this.playTone(400,.1,"triangle");setTimeout(()=>this.playTone(500,.1,"triangle"),60);setTimeout(()=>this.playTone(600,.15,"triangle"),120)}achievement(){const notes=[659,784,880,1047,1175];notes.forEach((freq,i)=>{setTimeout(()=>this.playTone(freq,.2,"sine"),i*100)})}click(){this.playTone(600,.05,"sine")}hover(){this.playTone(800,.03,"sine")}combatStart(){this.playNoise(.2,400);this.playTone(200,.3,"sawtooth");setTimeout(()=>this.playTone(250,.2,"sawtooth"),150)}enemyDefeated(){this.playChord([400,500,600],.2,"triangle")}heal(){this.playChord([523,659,784],.25,"sine")}skillUse(){this.playTone(700,.1,"sine");setTimeout(()=>this.playTone(900,.15,"sine"),50);setTimeout(()=>this.playTone(1100,.2,"sine"),100)}}export default SoundManager;