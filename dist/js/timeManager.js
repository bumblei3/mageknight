import{TIME_OF_DAY,GAME_EVENTS}from"./constants.js";import{eventBus}from"./eventBus.js";import{store,ACTIONS}from"./game/Store.js";export{TIME_OF_DAY};export class TimeManager{constructor(){this.round=1;this.timeOfDay=TIME_OF_DAY.DAY;this.listeners=[]}getMovementCostModifier(_terrainType){return this.isNight()}isDay(){return this.timeOfDay===TIME_OF_DAY.DAY}isNight(){return this.timeOfDay===TIME_OF_DAY.NIGHT}endRound(){this.round++;this.toggleTime();this.notifyListeners();return{round:this.round,timeOfDay:this.timeOfDay}}toggleTime(){this.timeOfDay=this.timeOfDay===TIME_OF_DAY.DAY?TIME_OF_DAY.NIGHT:TIME_OF_DAY.DAY}addListener(callback){this.listeners.push(callback)}notifyListeners(){const state={round:this.round,timeOfDay:this.timeOfDay};this.listeners.forEach(callback=>callback(state));eventBus.emit(GAME_EVENTS.TIME_CHANGED,state);if(store){store.dispatch(ACTIONS.SET_GAME_ROUND,this.round);store.dispatch(ACTIONS.SET_DAY_NIGHT,this.isNight())}}getState(){return{round:this.round,timeOfDay:this.timeOfDay}}loadState(state){this.round=state.round||1;this.timeOfDay=state.timeOfDay||TIME_OF_DAY.DAY;this.notifyListeners()}}