export class NotificationManager{static LOG_MAX_ENTRIES=50;static LOG_ICONS={info:"‚ÑπÔ∏è",success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",combat:"‚öîÔ∏è",discovery:"üó∫Ô∏è",achievement:"üèÜ",levelup:"‚¨ÜÔ∏è"};constructor(elements,tooltipManager){this.elements=elements;this.tooltipManager=tooltipManager;this.setupToastContainer();if(this.elements.gameLog&&this.tooltipManager){this.tooltipManager.attachToElement(this.elements.gameLog,null)}}setupToastContainer(){this.toastContainer=document.createElement("div");this.toastContainer.className="toast-container";document.body.appendChild(this.toastContainer)}showNotification(message,type="info"){this.addLog(message,type);this.showToast(message,type)}addLog(message,type="info",details=null){const logContainer=this.elements.gameLog;if(!logContainer)return;if(message===null||message===undefined)return;const msgStr=String(message);const lastEntry=logContainer.lastElementChild;if(!details&&lastEntry&&lastEntry.dataset.message===msgStr&&!lastEntry.dataset.hasDetails){let count=parseInt(lastEntry.dataset.count||"1",10)+1;lastEntry.dataset.count=count;const countBadge=lastEntry.querySelector(".log-count");if(countBadge){countBadge.textContent=`√ó${count}`;countBadge.style.display="inline"}logContainer.scrollTop=logContainer.scrollHeight;return}const entry=document.createElement("div");entry.className=`log-entry ${type}`;entry.dataset.message=msgStr;entry.dataset.count="1";if(details)entry.dataset.hasDetails="true";const now=new Date;const timeStr=now.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"});const icon=NotificationManager.LOG_ICONS[type]||NotificationManager.LOG_ICONS.info;let formattedMessage=msgStr.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*(.+?)\*/g,"<em>$1</em>");if(this.tooltipManager){formattedMessage=this.tooltipManager.injectKeywords(formattedMessage)}let detailsHTML="";if(details){detailsHTML='<div class="log-details">';if(Array.isArray(details)){detailsHTML+="<ul>";details.forEach(item=>detailsHTML+=`<li>${item}</li>`);detailsHTML+="</ul>"}else if(typeof details==="object"){if(details.items&&Array.isArray(details.items)){if(details.title)detailsHTML+=`<div class="details-title">${details.title}</div>`;detailsHTML+="<ul>";details.items.forEach(item=>detailsHTML+=`<li>${item}</li>`);detailsHTML+="</ul>"}else{detailsHTML+="<ul>";for(const[key,value]of Object.entries(details)){detailsHTML+=`<li><span class="detail-key">${key}:</span> <span class="detail-value">${value}</span></li>`}detailsHTML+="</ul>"}}else{detailsHTML+=String(details)}detailsHTML+="</div>";entry.classList.add("has-details");entry.addEventListener("click",_e=>{entry.classList.toggle("expanded")})}entry.innerHTML=`\n            <div class="log-header">\n                <span class="log-time" title="${now.toLocaleTimeString()}">${timeStr}</span>\n                <span class="log-icon">${icon}</span>\n                <span class="log-message">${formattedMessage}</span>\n                <span class="log-count" style="display: none;">√ó1</span>\n                ${details?'<span class="log-expander">‚ñº</span>':""}\n            </div>\n            ${detailsHTML}\n        `;logContainer.appendChild(entry);while(logContainer.childElementCount>NotificationManager.LOG_MAX_ENTRIES){logContainer.removeChild(logContainer.firstElementChild)}logContainer.scrollTop=logContainer.scrollHeight}showToast(message,type="info"){if(!this.toastContainer)this.setupToastContainer();const toast=document.createElement("div");toast.className=`toast ${type}`;const icons={success:"‚úÖ",error:"‚ùå",warning:"‚ö†Ô∏è",combat:"‚öîÔ∏è",info:"‚ÑπÔ∏è",achievement:"üèÜ",levelup:"‚¨ÜÔ∏è"};const icon=icons[type]||icons.info;toast.innerHTML=`<span class="toast-icon">${icon}</span> <span class="toast-message">${message}</span>`;this.toastContainer.appendChild(toast);setTimeout(()=>{toast.classList.add("hiding");toast.addEventListener("animationend",()=>{toast.remove()})},3e3)}clearLog(){if(this.elements.gameLog){this.elements.gameLog.innerHTML=""}}}