import{t}from"../i18n/index.js";export class TooltipManager{constructor(){this.tooltip=null;this.currentTarget=null;this.hideTimeout=null;this.createTooltipElement()}createTooltipElement(){this.tooltip=document.createElement("div");this.tooltip.className="game-tooltip";this.tooltip.style.display="none";document.body.appendChild(this.tooltip)}showCardTooltip(element,card){const content=this.createCardTooltipHTML(card);this.showTooltip(element,content)}showTerrainTooltip(element,terrainType,terrainData){const content=this.createTerrainTooltipHTML(terrainType,terrainData);this.showTooltip(element,content)}showEnemyTooltip(element,enemy){const content=this.createEnemyTooltipHTML(enemy);this.showTooltip(element,content)}showStatTooltip(element,statType,description){const content=`<div class="tooltip-stat"><strong>${statType}</strong><p>${description}</p></div>`;this.showTooltip(element,content)}showTooltip(element,htmlContent){clearTimeout(this.hideTimeout);this.currentTarget=element;this.tooltip.innerHTML=htmlContent;this.tooltip.style.display="block";this.positionTooltip(element);this.tooltip.style.opacity="0";setTimeout(()=>{this.tooltip.style.opacity="1"},10)}hideTooltip(delay=0){clearTimeout(this.hideTimeout);if(delay>0){this.hideTimeout=setTimeout(()=>{this.tooltip.style.opacity="0";setTimeout(()=>{this.tooltip.style.display="none";this.currentTarget=null},200)},delay)}else{this.tooltip.style.opacity="0";setTimeout(()=>{this.tooltip.style.display="none";this.currentTarget=null},200)}}attachToElement(element,content){if(!element)return;element.addEventListener("mouseenter",_e=>{let html=typeof content==="function"?content():content;if(!html&&element.dataset.tooltipType==="ability"){html=this.createAbilityTooltipHTML(element.dataset.tooltipKey)}if(html)this.showTooltip(element,html)});element.addEventListener("mouseleave",()=>{this.hideTooltip(100)});element.addEventListener("mouseover",e=>{if(e.target.classList.contains("glossary-term")){const term=e.target.dataset.term;if(term){this.currentTarget=e.target;this.showGlossaryTooltip(e.target,term);e.stopPropagation()}}});element.addEventListener("mouseout",e=>{if(e.target.classList.contains("glossary-term")){this.hideTooltip(100);e.stopPropagation()}})}register(element,description,title=""){if(!element)return;const html=`\n            <div class="tooltip-generic">\n                ${title?`<div class="tooltip-header"><span class="tooltip-name">${title}</span></div><div class="tooltip-divider"></div>`:""}\n                <div class="tooltip-description">${description}</div>\n            </div>\n        `;this.attachToElement(element,html)}createAbilityTooltipHTML(abilityKey){let desc=t(`enemies.abilities.descriptions.${abilityKey}`)||abilityKey;let title=abilityKey.charAt(0).toUpperCase()+abilityKey.slice(1);if(desc.includes(":")){const parts=desc.split(":");title=parts[0].trim();desc=parts.slice(1).join(":").trim()}const icons={fire:"ğŸ”¥",ice:"â„ï¸",cold_fire:"ğŸ”¥â„ï¸",physical:"âš”ï¸",fortified:"ğŸ°",swift:"ğŸ’¨",poison:"ğŸ¤¢",vampiric:"ğŸ§›",brutal:"ğŸ‘¹",paralyze:"âš¡",cumbersome:"ğŸ‹ï¸",assassin:"ğŸ—¡ï¸",boss:"ğŸ‘‘",summoner:"ğŸ¦‡",elusive:"ğŸ‘¤"};const icon=icons[abilityKey]||"";return`\n            <div class="tooltip-ability-desc">\n                <div class="tooltip-header">\n                    ${icon?`<span class="tooltip-icon">${icon}</span>`:""}\n                    <span class="tooltip-name">${title}</span>\n                </div>\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-description">${desc}</div>\n            </div>\n        `}positionTooltip(element){const rect=element.getBoundingClientRect();const tooltipRect=this.tooltip.getBoundingClientRect();let left=rect.left+rect.width/2-tooltipRect.width/2;let top=rect.top-tooltipRect.height-10;if(left+tooltipRect.width>window.innerWidth-20){left=window.innerWidth-tooltipRect.width-20}if(left<20){left=20}if(top<20){top=rect.bottom+10;this.tooltip.classList.add("below")}else{this.tooltip.classList.remove("below")}this.tooltip.style.left=`${left}px`;this.tooltip.style.top=`${top}px`}createCardTooltipHTML(card){const effects=card.getEffect(false);const sidewaysEffects=card.canPlaySideways();let html=`\n            <div class="tooltip-card">\n                <div class="tooltip-header">\n                    <span class="tooltip-card-name">${card.name}</span>\n                    <span class="tooltip-card-color ${card.color}">${this.getColorIcon(card.color)}</span>\n                </div>\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-effects">\n                    <div class="tooltip-section">\n                        <strong>ğŸ“œ ${t("cards.basicEffect")}:</strong>\n        `;if(effects.movement)html+=`<div>ğŸŒ¿ ${t("cards.actions.movement")}: <span class="value">+${effects.movement}</span></div>`;if(effects.attack)html+=`<div>âš”ï¸ ${t("cards.actions.attack")}: <span class="value">+${effects.attack}</span></div>`;if(effects.block)html+=`<div>ğŸ›¡ï¸ ${t("cards.actions.block")}: <span class="value">+${effects.block}</span></div>`;if(effects.influence)html+=`<div>ğŸ’¬ ${t("cards.actions.influence")}: <span class="value">+${effects.influence}</span></div>`;if(effects.healing)html+=`<div>â¤ï¸ ${t("cards.actions.healing")}: <span class="value">+${effects.healing}</span></div>`;html+="</div>";if(sidewaysEffects){html+=`\n                <div class="tooltip-section">\n                    <strong>ğŸ”„ ${t("cards.sideways")}:</strong>\n                    <div class="tooltip-hint">${t("cards.sidewaysHint")}</div>\n                </div>\n            `}if(card.manaCost&&card.manaCost.length>0){html+=`\n                <div class="tooltip-section">\n                    <strong>ğŸ’ ${t("cards.manaCost")}:</strong>\n                    <div>${card.manaCost.map(m=>this.getManaHTML(m)).join(" ")}</div>\n                </div>\n            `}html+="</div></div>";return html}createTerrainTooltipHTML(terrainType,_terrainData){const icons={plains:"ğŸŒ¾",forest:"ğŸŒ²",hills:"â›°ï¸",mountains:"ğŸ”ï¸",desert:"ğŸœï¸",wasteland:"â˜ ï¸",water:"ğŸ’§"};const costs={plains:2,forest:3,hills:3,mountains:5,desert:5,wasteland:3,water:"âˆ"};const nameKey=`terrain.${terrainType}.name`;const descKey=`terrain.${terrainType}.desc`;const name=t(nameKey)!==nameKey?t(nameKey):terrainType==="unknown"?"Unbekannt":terrainType;const desc=t(descKey)!==descKey?t(descKey):"";const icon=icons[terrainType]||"â“";const cost=costs[terrainType]||"?";return`\n            <div class="tooltip-terrain">\n                <div class="tooltip-header">\n                    <span class="tooltip-icon">${icon}</span>\n                    <span class="tooltip-name">${name}</span>\n                </div>\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-stat-row">\n                    <span>ğŸ‘£ ${t("ui.labels.movement")}:</span>\n                    <span class="value">${cost}</span>\n                </div>\n                <div class="tooltip-description">${desc}</div>\n            </div>\n        `}createEnemyTooltipHTML(enemy){return`\n            <div class="tooltip-enemy">\n                <div class="tooltip-header">\n                    <span class="tooltip-name">${enemy.name}</span>\n                </div>\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-stats">\n                    <div class="tooltip-stat-row">\n                        <span>ğŸ›¡ï¸ ${t("mana.armor")}:</span>\n                        <span class="value">${enemy.armor}</span>\n                    </div>\n                    <div class="tooltip-stat-row">\n                        <span>âš”ï¸ ${t("mana.attack")}:</span>\n                        <span class="value">${enemy.attack}</span>\n                    </div>\n                    <div class="tooltip-stat-row">\n                        <span>â­ ${t("mana.fame")}:</span>\n                        <span class="value">${enemy.fame}</span>\n                    </div>\n                    ${enemy.fortified?`<div class="tooltip-ability">ğŸ° ${t("mana.fortified")}</div>`:""}\n                </div>\n            </div>\n        `}getColorIcon(color){const icons={green:"ğŸŒ¿",red:"âš”ï¸",blue:"ğŸ›¡ï¸",white:"ğŸ’¬",gold:"â­"};return icons[color]||"â“"}getManaHTML(color){const colors={red:"ğŸ”¥",blue:"ğŸ’§",white:"âœ¨",green:"ğŸŒ¿",gold:"ğŸ’°"};return`<span class="mana-icon ${color}">${colors[color]||"ğŸ’"}</span>`}createStatTooltipHTML(statType,description){return`\n            <div class="tooltip-stat">\n                <strong>${statType}</strong>\n                <p>${description}</p>\n            </div>\n        `}createSiteTooltipHTML(site){const info=site.getInfo();const localizedName=site.type&&t(`sites.${site.type}`)!==`sites.${site.type}`?t(`sites.${site.type}`):info.name;const status=site.conquered?`<span class="status-conquered">ğŸ‘‘ ${t("sites.conquered")}</span>`:site.visited?`<span class="status-visited">âœ“ ${t("sites.visited")}</span>`:"";let actionsHtml="";if(info.actions){actionsHtml='<div class="tooltip-actions">';info.actions.forEach(action=>{actionsHtml+=`<span class="action-tag">${this.getActionIcon(action)} ${this.getActionName(action)}</span>`});actionsHtml+="</div>"}return`\n            <div class="tooltip-site" style="border-left-color: ${info.color}">\n                <div class="tooltip-header">\n                    <span class="tooltip-icon">${info.icon}</span>\n                    <span class="tooltip-name">${localizedName}</span>\n                </div>\n                ${status?`<div class="tooltip-status">${status}</div>`:""}\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-description">${info.description}</div>\n                ${actionsHtml}\n            </div>\n        `}getActionIcon(action){const icons={heal:"â¤ï¸",recruit:"ğŸ‘¥",attack:"âš”ï¸",train:"ğŸ“š",learn:"âœ¨",explore:"ğŸ”"};return icons[action]||"â€¢"}getActionName(action){return t(`sites.actions.${action}`)||action}injectKeywords(text){if(!text)return"";let processed=text;const terms=["Vampirismus","Befestigt","LÃ¤hmung","Flink","Brutal","Gift","SchwerfÃ¤llig","AttentÃ¤ter","BeschwÃ¶rer","Ausweichend","Resistenz","Block","Wunde","RÃ¼stung","Fernkampf","Belagerung","Tag","Nacht"];const map={Vampirismus:"vampirism",Befestigt:"fortified","LÃ¤hmung":"paralyze",Flink:"swift",Brutal:"brutal",Gift:"poison","SchwerfÃ¤llig":"cumbersome","AttentÃ¤ter":"assassin","BeschwÃ¶rer":"summoner",Ausweichend:"elusive",Resistenz:"resistance",Block:"block",Wunde:"wound","RÃ¼stung":"armor",Fernkampf:"ranged",Belagerung:"siege",Tag:"day",Nacht:"night"};terms.forEach(term=>{const regex=new RegExp(`\\b(${term})\\b`,"gi");const key=map[term];if(key){processed=processed.replace(regex,`<span class="glossary-term" data-term="${key}">$1</span>`)}});return processed}showGlossaryTooltip(element,termKey){const name=t(`glossary.${termKey}.name`)||termKey;const desc=t(`glossary.${termKey}.desc`)||"Keine Beschreibung verfÃ¼gbar.";const content=`\n            <div class="tooltip-glossary">\n                <div class="tooltip-header">\n                    <span class="tooltip-name">${name}</span>\n                </div>\n                <div class="tooltip-divider"></div>\n                <div class="tooltip-description">${desc}</div>\n            </div>\n        `;this.showTooltip(element,content)}}export default TooltipManager;