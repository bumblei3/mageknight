<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Mage Knight - A strategic web-based board game adventure. Explore, fight, and conquer in this digital adaptation.">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="icon" type="image/png" href="favicon.png">
    <title data-i18n="game.title">Mage Knight - Base Game</title>

    <!-- Preconnect to Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;700;800&display=swap">

    <!-- Load fonts non-blocking -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Outfit:wght@400;500;700;800&display=swap"
        media="print" onload="this.media='all'">

    <!-- Defer all CSS -->
    <link rel="stylesheet" href="css/reset.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/layout.css" media="print" onload="this.media='all'">
    <!-- Defer HUD styles since loading screen shows first -->
    <link rel="stylesheet" href="css/hud.css" media="print" onload="this.media='all'">

    <!-- Defer non-critical CSS -->
    <link rel="stylesheet" href="css/cards.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/modals.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/tutorial.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/effects.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/icons.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/floating-text.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/tooltips.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/rewards.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/loading.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="css/mobile.css" media="print" onload="this.media='all'">

    <noscript>
        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/layout.css">
        <link rel="stylesheet" href="css/hud.css">
        <link rel="stylesheet" href="css/cards.css">
        <link rel="stylesheet" href="css/modals.css">
        <link rel="stylesheet" href="css/tutorial.css">
        <link rel="stylesheet" href="css/effects.css">
        <link rel="stylesheet" href="css/icons.css">
        <link rel="stylesheet" href="css/floating-text.css">
        <link rel="stylesheet" href="css/tooltips.css">
        <link rel="stylesheet" href="css/rewards.css">
        <link rel="stylesheet" href="css/loading.css">
    </noscript>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#a855f7">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <script type="importmap">
        {
            "imports": {
                "three": "./js/vendor/three.module.js",
                "three/addons/": "./js/vendor/"
            }
        }
    </script>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-particles">
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
            <div class="loading-particle"></div>
        </div>
        <div class="loading-logo">Mage Knight</div>
        <div class="loading-spinner-container">
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-icon">‚öîÔ∏è</div>
        </div>
        <div class="loading-progress-container">
            <div id="loading-progress" class="loading-progress-bar"></div>
        </div>
        <div id="loading-status" class="loading-status">Initialisiere...</div>
        <div class="loading-tip"><strong>Tipp:</strong> Rechtsklick auf Karten spielt sie seitlich f√ºr +1 Effekt.
        </div>
    </div>

    <div class="game-container" id="game-container">
        <!-- Persistent Background Ambiance -->
        <div class="background-aura"></div>
        <div class="background-particles"></div>

        <!-- Header -->
        <!-- Immersive Background Canvas -->
        <div class="canvas-layer">
            <canvas id="game-board" width="1600" height="1200"></canvas>
        </div>
        <!-- 3D Layer -->
        <div id="game-container-3d"
            style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: 5; contain: strict;">
        </div>

        <!-- HUD Layer (Overlay) -->
        <div class="hud-layer">
            <!-- Top Bar -->
            <header class="hud-top-bar">
                <div class="header-left">
                    <div class="game-logo" data-i18n="game.title">Mage Knight</div>
                    <div class="time-indicator-container">
                        <span id="time-icon" class="time-icon">‚òÄÔ∏è</span>
                        <span class="round-display"><span data-i18n="ui.labels.round">Runde</span> <span
                                id="round-number" class="round-number">1</span></span>
                    </div>
                </div>
                <div class="header-center">
                    <!-- Global Status / Messages could go here -->
                </div>
                <div class="header-right">
                    <div class="stat-pill">
                        <span class="stat-label" data-i18n="ui.labels.fame">Ruhm</span>
                        <span class="stat-value" id="fame-value">0</span>
                    </div>
                    <div class="stat-pill">
                        <span class="stat-label" data-i18n="ui.labels.reputation">Ansehen</span>
                        <span class="stat-value" id="reputation-value">0</span>
                    </div>
                    <div class="header-controls">
                        <button class="btn-icon" id="settings-btn" title="Einstellungen">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path
                                    d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="toggle-3d-btn" title="3D Ansicht umschalten">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <rect x="2" y="2" width="20" height="20" rx="2" />
                                <circle cx="8" cy="8" r="1.5" fill="currentColor" />
                                <circle cx="16" cy="8" r="1.5" fill="currentColor" />
                                <circle cx="8" cy="16" r="1.5" fill="currentColor" />
                                <circle cx="16" cy="16" r="1.5" fill="currentColor" />
                                <circle cx="12" cy="12" r="1.5" fill="currentColor" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="language-btn" title="Sprache wechseln"
                            data-i18n-title="ui.buttons.settings">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" />
                                <path
                                    d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="new-game-btn" title="Neues Spiel"
                            data-i18n-title="ui.buttons.newGame">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                                <path d="M21 3v5h-5" />
                                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                                <path d="M3 21v-5h5" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="save-btn" title="Speichern (Ctrl+S)"
                            data-i18n-title="ui.buttons.save">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                                <polyline points="17 21 17 13 7 13 7 21" />
                                <polyline points="7 3 7 8 15 8" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="load-btn" title="Laden (Ctrl+L)" data-i18n-title="ui.buttons.load">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="undo-btn" title="R√ºckg√§ngig (Ctrl+Z)">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path d="M3 7v6h6" />
                                <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" />
                            </svg>
                        </button>
                        <button class="btn-help" id="help-btn" title="Hilfe anzeigen">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10" />
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                <line x1="12" y1="17" x2="12.01" y2="17" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="achievements-btn" title="Erfolge anzeigen">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                                <path d="M4 22h16" />
                                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
                            </svg>
                        </button>
                        <button class="btn-icon" id="statistics-btn" title="Statistiken anzeigen">
                            <svg class="hud-icon" viewBox="0 0 24 24">
                                <line x1="18" y1="20" x2="18" y2="10" />
                                <line x1="12" y1="20" x2="12" y2="4" />
                                <line x1="6" y1="20" x2="6" y2="14" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Left HUD (Hero & Actions) -->
            <aside class="hud-sidebar hud-left">
                <div class="panel hero-panel collapsed-check">
                    <div class="panel-header">
                        <h2 data-i18n="ui.labels.hero">Held</h2>
                        <button class="panel-toggle">_</button>
                    </div>
                    <div class="hero-info">
                        <div class="hero-avatar" id="hero-avatar"></div>
                        <div class="hero-details">
                            <div class="hero-name" id="hero-name">Goldyx</div>
                            <div class="hero-stats-grid">
                                <div class="stat-item" title="R√ºstung">
                                    <svg class="stat-icon armor" viewBox="0 0 24 24">
                                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                    </svg>
                                    <span id="hero-armor">2</span>
                                </div>
                                <div class="stat-item" title="Handlimit">
                                    <svg class="stat-icon hand" viewBox="0 0 24 24">
                                        <rect x="3" y="4" width="6" height="10" rx="1" />
                                        <rect x="9" y="2" width="6" height="10" rx="1" />
                                        <rect x="15" y="4" width="6" height="10" rx="1" />
                                    </svg>
                                    <span id="hero-handlimit">5</span>
                                </div>
                                <div class="stat-item" title="Verletzungen">
                                    <svg class="stat-icon wounds" viewBox="0 0 24 24">
                                        <path
                                            d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                                        <path d="m12 13-1-1 2-2-3-3 2-2" />
                                    </svg>
                                    <span id="hero-wounds">0</span>
                                </div>
                            </div>
                            <div id="skill-list" class="skill-list-container"></div>
                        </div>
                    </div>
                </div>

                <div class="panel action-panel">
                    <h2 data-i18n="ui.labels.actions">Aktionen</h2>
                    <div class="action-grid">
                        <button class="btn btn-primary" id="end-turn-btn" data-i18n="ui.buttons.endTurn">Zug
                            beenden</button>
                        <button class="btn btn-secondary" id="rest-btn" data-i18n="ui.buttons.rest">Rasten</button>
                        <button class="btn btn-secondary" id="explore-btn" disabled
                            data-i18n="ui.buttons.explore">Erkunden</button>
                        <button class="btn btn-success" id="heal-btn" style="display: none;"
                            data-i18n="ui.buttons.heal">Heilen</button>
                        <button class="btn btn-primary" id="visit-btn" style="display: none;">Besuchen</button>
                    </div>
                </div>

                <div class="panel movement-panel">
                    <div class="movement-display">
                        <span class="stat-icon">üë£</span>
                        <span class="stat-value" id="movement-points">0</span>
                    </div>
                    <div id="movement-preview" class="movement-preview" style="display: none;">
                        <span class="preview-label">Kosten:</span>
                        <span class="preview-value" id="movement-preview-value">0</span>
                    </div>
                </div>

                <div class="panel units-panel">
                    <h2 data-i18n="ui.labels.units">Einheiten</h2>
                    <div class="units-container" id="hero-units"></div>
                </div>
            </aside>

            <!-- Right HUD (Log, Mana, Combat) -->
            <aside class="hud-sidebar hud-right">
                <div class="panel phase-panel">
                    <div class="phase-indicator" id="phase-indicator">
                        <div class="phase-text">Erkundung</div>
                        <div class="phase-hint" id="phase-hint">Spiele Karten...</div>
                    </div>
                </div>

                <div class="panel mana-panel">
                    <h2 data-i18n="ui.labels.manaSource">Mana-Quelle</h2>
                    <div class="mana-dice" id="mana-source"></div>
                </div>

                <div class="panel combat-panel" id="combat-panel" style="display: none;">
                    <h2 data-i18n="ui.phases.combat">Kampf</h2>
                    <div class="combat-info" id="combat-info"></div>
                    <div class="combat-units" id="combat-units"></div>
                    <button class="btn btn-primary" id="execute-attack-btn" style="display: none;">‚öîÔ∏è
                        Angriff</button>
                </div>

                <div class="panel log-panel minimized">
                    <h2 data-i18n="ui.labels.log">Protokoll</h2>
                    <div class="game-log" id="game-log">
                        <div class="log-entry">Willkommen bei Mage Knight!</div>
                    </div>
                </div>
            </aside>

            <!-- Bottom Dock (Cards) -->
            <div class="bottom-dock">
                <div id="play-area" class="play-area" style="display: none;">
                    <h3>Gespielt</h3>
                    <div id="played-cards" class="played-cards-container"></div>
                </div>
                <div id="hand-cards" class="hand-cards-container"></div>
            </div>
        </div>

        <!-- Keyboard Shortcuts Info -->
        <div class="shortcuts-bar" id="shortcuts-bar">
            <div class="shortcut-item">
                <kbd>1-5</kbd> Karten spielen
            </div>
            <div class="shortcut-item">
                <kbd>Space</kbd> Zug beenden
            </div>
            <div class="shortcut-item">
                <kbd>R</kbd> Rasten
            </div>
            <div class="shortcut-item">
                <kbd>Ctrl+S</kbd> Speichern
            </div>
            <div class="shortcut-item">
                <kbd>Ctrl+L</kbd> Laden
            </div>
            <div class="shortcut-item">
                <kbd>T</kbd> Tutorial
            </div>
            <div class="shortcut-item">
                <kbd>H</kbd> Hilfe
            </div>
            <div class="shortcut-item">
                <kbd>Esc</kbd> Abbrechen
            </div>
        </div>

        <!-- Hand Cards Area with integrated Play Area -->
    </div>

    <!-- Modal for card details -->
    <div class="modal" id="card-modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modal-card-details"></div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal" id="help-modal">
        <div class="modal-content help-modal-content">
            <span class="modal-close" id="help-close">&times;</span>
            <h2>üó°Ô∏è Mage Knight Hilfe</h2>

            <div class="help-tabs">
                <button class="help-tab active" data-tab="basics">Grundlagen</button>
                <button class="help-tab" data-tab="cards">Karten</button>
                <button class="help-tab" data-tab="movement">Bewegung</button>
                <button class="help-tab" data-tab="combat">Kampf</button>
                <button class="help-tab" data-tab="terrain">Terrain</button>
            </div>

            <div class="help-content">
                <!-- Basics Tab -->
                <div class="help-tab-content active" id="help-basics">
                    <h3>Spielziel</h3>
                    <p>Besiege alle Feinde auf der Karte, um zu gewinnen!</p>

                    <h3>Spielablauf</h3>
                    <ol>
                        <li><strong>Karten spielen</strong> - Klicke auf Karten in deiner Hand</li>
                        <li><strong>Bewegen</strong> - Klicke auf Hex-Felder um dich zu bewegen</li>
                        <li><strong>K√§mpfen</strong> - Betritt Felder mit Feinden</li>
                        <li><strong>Zug beenden</strong> - Klicke "Zug beenden" f√ºr neue Karten</li>
                    </ol>

                    <h3>Wichtige Tastenbelegung</h3>
                    <ul>
                        <li><strong>Linksklick auf Karte</strong> - Spielt Basis-Wirkung</li>
                        <li><strong>Rechtsklick auf Karte</strong> - Spielt Karte seitlich (+1)</li>
                        <li><strong>Klick auf Hex</strong> - Bewegt Held oder w√§hlt Feld aus</li>
                        <li><strong>Strg+Z / ‚Ü©Ô∏è Button</strong> - Letzte Aktion r√ºckg√§ngig machen</li>
                    </ul>

                    <h3>Held Stats</h3>
                    <ul>
                        <li><strong>üõ°Ô∏è R√ºstung</strong> - Reduziert erhaltenen Schaden</li>
                        <li><strong>üé¥ Handlimit</strong> - Max. Karten auf der Hand</li>
                        <li><strong>üíî Verletzungen</strong> - Blockieren Kartenslots</li>
                        <li><strong>‚≠ê Ruhm</strong> - Punkte f√ºr besiegte Feinde</li>
                        <li><strong>üí¨ Ansehen</strong> - Beeinflusst Interaktionen</li>
                    </ul>
                </div>

                <!-- Cards Tab -->
                <div class="help-tab-content" id="help-cards">
                    <h3>Kartentypen</h3>
                    <div class="help-card-types">
                        <div class="help-card-type">
                            <span class="help-icon" style="color: #10b981;">üåø</span>
                            <strong>Gr√ºne Karten</strong>
                            <p>Bewegungskarten - Geben Bewegungspunkte</p>
                        </div>
                        <div class="help-card-type">
                            <span class="help-icon" style="color: #ef4444;">‚öîÔ∏è</span>
                            <strong>Rote Karten</strong>
                            <p>Angriffskarten - F√ºgen Feinden Schaden zu</p>
                        </div>
                        <div class="help-card-type">
                            <span class="help-icon" style="color: #3b82f6;">üõ°Ô∏è</span>
                            <strong>Blaue Karten</strong>
                            <p>Block-Karten - Blocken Feindangriffe</p>
                        </div>
                        <div class="help-card-type">
                            <span class="help-icon" style="color: #f3f4f6;">üí¨</span>
                            <strong>Wei√üe Karten</strong>
                            <p>Einfluss/Heilung - F√ºr Interaktionen</p>
                        </div>
                    </div>

                    <h3>Kartenwirkungen</h3>
                    <ul>
                        <li><strong>Basic</strong> - Grundwirkung ohne Mana</li>
                        <li><strong>Strong</strong> - Verst√§rkte Wirkung mit Mana (in Entwicklung)</li>
                        <li><strong>Seitlich spielen</strong> - Jede Karte kann f√ºr +1
                            Bewegung/Angriff/Block/Einfluss
                            gespielt werden</li>
                    </ul>

                    <h3>Kartenverwaltung</h3>
                    <p>Am Ende deines Zugs:</p>
                    <ul>
                        <li>Gespielte Karten ‚Üí Ablage</li>
                        <li>Ziehe neue Karten bis Handlimit</li>
                        <li>Wenn Deck leer: Ablage wird gemischt</li>
                    </ul>
                </div>

                <!-- Movement Tab -->
                <div class="help-tab-content" id="help-movement">
                    <h3>Bewegung Schritt f√ºr Schritt</h3>
                    <ol>
                        <li>Spiele eine oder mehrere <strong>gr√ºne Bewegungskarten</strong></li>
                        <li>Bewegungspunkte werden addiert (oben links im Panel)</li>
                        <li>Erreichbare Felder werden <strong>violett hervorgehoben</strong></li>
                        <li>Klicke auf ein hervorgehobenes Feld</li>
                        <li>Dein Held bewegt sich dorthin</li>
                        <li>Bewegungskosten werden abgezogen</li>
                    </ol>

                    <h3>Bewegungskosten</h3>
                    <p>Jedes Terrain hat unterschiedliche Kosten:</p>
                    <ul>
                        <li>üåæ <strong>Ebenen</strong> - 2 Punkte</li>
                        <li>üå≤ <strong>Wald</strong> - 3 Punkte</li>
                        <li>‚õ∞Ô∏è <strong>H√ºgel</strong> - 3 Punkte</li>
                        <li>üèîÔ∏è <strong>Berge</strong> - 5 Punkte</li>
                        <li>üèúÔ∏è <strong>W√ºste</strong> - 3 Punkte</li>
                        <li>‚ò†Ô∏è <strong>√ñdland</strong> - 3 Punkte</li>
                        <li>üíß <strong>Wasser</strong> - Unpassierbar</li>
                    </ul>

                    <h3>Tipps</h3>
                    <ul>
                        <li>Plane deine Route vorher durch</li>
                        <li>Ebenen sind am g√ºnstigsten</li>
                        <li>Vermeide Berge wenn m√∂glich</li>
                        <li>Du kannst mehrere Bewegungskarten kombinieren</li>
                    </ul>
                </div>

                <!-- Combat Tab -->
                <div class="help-tab-content" id="help-combat">
                    <h3>Kampf starten</h3>
                    <p>Ein Kampf beginnt automatisch, wenn du ein Feld mit einem Feind betrittst.</p>

                    <h3>Kampfphasen</h3>
                    <div class="combat-phases">
                        <div class="combat-phase">
                            <strong>1Ô∏è‚É£ Block-Phase</strong>
                            <ul>
                                <li>Spiele <strong>blaue Block-Karten</strong></li>
                                <li>Blocke den Feind-Angriff vollst√§ndig</li>
                                <li>Block ‚â• Feind-Angriff ‚Üí Feind geblockt</li>
                                <li>Klicke "Zug beenden" f√ºr n√§chste Phase</li>
                            </ul>
                        </div>
                        <div class="combat-phase">
                            <strong>2Ô∏è‚É£ Schadens-Phase</strong>
                            <ul>
                                <li>Ungeblockte Feinde f√ºgen Schaden zu</li>
                                <li>Schaden / Deine R√ºstung = Verletzungen (aufgerundet)</li>
                                <li>Verletzungen kommen auf deine Hand</li>
                                <li>Phase l√§uft automatisch ab</li>
                            </ul>
                        </div>
                        <div class="combat-phase">
                            <strong>3Ô∏è‚É£ Angriffs-Phase</strong>
                            <ul>
                                <li>Spiele <strong>rote Angriffs-Karten</strong></li>
                                <li>Angriff ‚â• Feind-R√ºstung ‚Üí Feind besiegt</li>
                                <li>Erhalte Ruhm f√ºr besiegte Feinde</li>
                                <li>Kampf endet automatisch</li>
                            </ul>
                        </div>
                    </div>

                    <h3>Feind-Stats</h3>
                    <ul>
                        <li><strong>üõ°Ô∏è R√ºstung</strong> - Muss √ºberwunden werden</li>
                        <li><strong>‚öîÔ∏è Angriff</strong> - Schaden den der Feind zuf√ºgt</li>
                        <li><strong>‚≠ê Ruhm</strong> - Belohnung f√ºr Sieg</li>
                    </ul>

                    <h3>Kampf-Tipps</h3>
                    <ul>
                        <li>Blocke starke Gegner wenn m√∂glich</li>
                        <li>Spare Angriffskarten f√ºr schwere Feinde auf</li>
                        <li>Kombiniere mehrere Karten f√ºr gro√üe Wirkungen</li>
                        <li>Verletzungen k√∂nnen nur durch Rasten/Heilung entfernt werden</li>
                    </ul>
                </div>

                <!-- Terrain Tab -->
                <div class="help-tab-content" id="help-terrain">
                    <h3>Terrain-Typen</h3>

                    <div class="terrain-list">
                        <div class="terrain-item">
                            <span class="terrain-icon">üåæ</span>
                            <div>
                                <strong>Ebenen</strong>
                                <p>Kosten: 2 | Offenes Grasland, leicht zu durchqueren</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">üå≤</span>
                            <div>
                                <strong>Wald</strong>
                                <p>Kosten: 3 | Dichter Wald, erschwert Bewegung</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">‚õ∞Ô∏è</span>
                            <div>
                                <strong>H√ºgel</strong>
                                <p>Kosten: 3 | H√ºgeliges Gel√§nde</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">üèîÔ∏è</span>
                            <div>
                                <strong>Berge</strong>
                                <p>Kosten: 5 | Hohe Berge, sehr schwer zu passieren</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">üèúÔ∏è</span>
                            <div>
                                <strong>W√ºste</strong>
                                <p>Kosten: 3 | Trockene W√ºste</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">‚ò†Ô∏è</span>
                            <div>
                                <strong>√ñdland</strong>
                                <p>Kosten: 3 | Verfluchtes, unwirtliches Land</p>
                            </div>
                        </div>

                        <div class="terrain-item">
                            <span class="terrain-icon">üíß</span>
                            <div>
                                <strong>Wasser</strong>
                                <p>Kosten: ‚àû | <strong>Unpassierbar</strong></p>
                            </div>
                        </div>
                    </div>

                    <h3>Strategie-Tipps</h3>
                    <ul>
                        <li>Plane deine Route entlang von Ebenen wenn m√∂glich</li>
                        <li>Vermeide Berge au√üer in Notf√§llen</li>
                        <li>Manchmal ist eine l√§ngere Route √ºber Ebenen schneller</li>
                        <li>Spare Bewegungspunkte f√ºr den Kampf</li>
                    </ul>
                </div>
            </div>

            <div class="help-footer">
                <p><strong>Tipp:</strong> Dr√ºcke <kbd>Esc</kbd> oder klicke au√üerhalb, um die Hilfe zu schlie√üen</p>
            </div>
        </div>
    </div>

    <!-- Rest Modal -->
    <div class="modal" id="rest-modal">
        <div class="modal-content rest-modal-content">
            <span class="modal-close" id="rest-close">&times;</span>
            <h2>üí§ Rasten</h2>

            <p class="rest-explanation">
                W√§hle Karten aus, die du ablegen m√∂chtest. Du ziehst dann neue Karten bis zu deinem Handlimit.
                <strong>Hinweis:</strong> Beim Rasten erh√§ltst du keine neuen Mana-W√ºrfel.
            </p>

            <div class="rest-cards" id="rest-cards">
                <!-- Cards will be dynamically added here -->
            </div>

            <div class="rest-actions">
                <button class="btn btn-secondary" id="rest-cancel">Abbrechen</button>
                <button class="btn btn-primary" id="rest-confirm">Rasten best√§tigen</button>
            </div>
        </div>
    </div>

    <!-- Site Interaction Modal -->
    <div class="modal" id="site-modal">
        <div class="modal-content site-modal-content">
            <span class="modal-close" id="site-close">&times;</span>
            <div class="site-header">
                <div class="site-icon" id="site-modal-icon"></div>
                <h2 id="site-modal-title">Ort</h2>
            </div>
            <p id="site-modal-description" class="site-description"></p>

            <div class="site-options" id="site-options">
                <!-- Options injected here -->
            </div>
        </div>
    </div>

    <!-- World Event Modal -->
    <div class="modal" id="event-modal">
        <div class="modal-content event-modal-content">
            <span class="modal-close" id="event-close">&times;</span>
            <div class="event-header">
                <h2 id="event-title">Event</h2>
            </div>
            <p id="event-description" class="event-description"></p>

            <div class="event-options" id="event-options">
                <!-- Options injected here -->
            </div>
        </div>
    </div>

    <!-- Card Play Modal (Mana Amplification) -->
    <div class="modal" id="card-play-modal">
        <div class="modal-content card-play-content">
            <span class="modal-close" id="card-play-close">&times;</span>
            <h2>Wirkung w√§hlen</h2>
            <div id="card-play-preview" class="card-play-preview"></div>

            <div class="play-options">
                <button class="play-option-btn basic" id="play-basic-btn">
                    <div class="option-header">Basis</div>
                    <div class="option-effect" id="basic-effect-desc">Move 2</div>
                    <div class="option-cost">Kostenlos</div>
                </button>

                <button class="play-option-btn strong" id="play-strong-btn">
                    <div class="option-header">Verst√§rkt ‚ú®</div>
                    <div class="option-effect" id="strong-effect-desc">Move 4</div>
                    <div class="option-cost" id="strong-cost-desc">-1 Blaues Mana</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Level Up Modal -->
    <div id="level-up-modal" class="modal">
        <div class="modal-content level-up-content">
            <h2 class="modal-title">Stufenaufstieg!</h2>
            <div class="level-up-message">Du hast Stufe <span id="new-level-display">2</span> erreicht!</div>

            <div class="level-up-section">
                <h3>W√§hle eine Fertigkeit:</h3>
                <div id="skill-choices" class="choices-grid">
                    <!-- Skills will be rendered here -->
                </div>
            </div>

            <div class="level-up-section">
                <h3>W√§hle eine Fortgeschrittene Aktion:</h3>
                <div id="card-choices" class="choices-grid">
                    <!-- Cards will be rendered here -->
                </div>
            </div>

            <button id="confirm-level-up" class="btn btn-primary" disabled>Best√§tigen</button>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div class="modal" id="achievements-modal">
        <div class="modal-content achievements-modal-content">
            <span class="modal-close" id="achievements-close">&times;</span>
            <h2>üèÜ Erfolge</h2>
            <div class="achievements-summary">
                <div class="progress-bar-container">
                    <div class="progress-bar" id="achievements-progress-bar" style="width: 0%"></div>
                </div>
                <span id="achievements-progress-text">0/0 Freigeschaltet</span>
            </div>
            <div class="achievements-tabs">
                <button class="tab-btn active" data-category="all">Alle</button>
                <button class="tab-btn" data-category="combat">Kampf</button>
                <button class="tab-btn" data-category="exploration">Erkundung</button>
                <button class="tab-btn" data-category="progression">Fortschritt</button>
                <button class="tab-btn" data-category="mastery">Meisterschaft</button>
            </div>
            <div class="achievements-list" id="achievements-list">
                <!-- Achievements will be injected here -->
            </div>
        </div>
    </div>

    <!-- Reward Selection Modal -->
    <div id="reward-modal" class="modal">
        <div class="modal-content reward-content">
            <h2 class="modal-title" data-i18n="ui.labels.victoryReward">Belohnung w√§hlen!</h2>
            <div class="reward-message" data-i18n="ui.labels.artifactFound">Du hast einen uralten Schatz gefunden!
                W√§hle
                ein Artefakt:</div>

            <div id="reward-choices" class="choices-grid reward-grid">
                <!-- Artifact choices will be rendered here -->
            </div>

            <p class="reward-hint">Klicke auf ein Artefakt, um es deinem Deck hinzuzuf√ºgen.</p>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div class="modal" id="statistics-modal">
        <div class="modal-content statistics-modal-content">
            <span class="modal-close" id="statistics-close">&times;</span>
            <h2>üìä Statistiken</h2>
            <div class="statistics-tabs">
                <button class="tab-btn active" data-category="global">Global</button>
                <button class="tab-btn" data-category="current">Aktuelles Spiel</button>
            </div>
            <div class="statistics-grid" id="statistics-grid">
                <!-- Statistics will be injected here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Day/Night Transition Overlay -->
    <div id="day-night-overlay" class="day-night-overlay">
        <div id="day-night-message" class="day-night-message">Nacht bricht herein...</div>
    </div>

    <!-- Scenario Selection Modal -->
    <div class="modal" id="scenario-selection-modal">
        <div class="modal-content scenario-selection-content">
            <span class="modal-close" id="scenario-selection-close">&times;</span>
            <div class="scenario-selection-header">
                <h2 data-i18n="ui.titles.selectScenario">Szenario w√§hlen</h2>
                <p data-i18n="ui.labels.selectScenarioDesc">W√§hle dein n√§chstes Abenteuer. Jedes Szenario bietet
                    einzigartige Herausforderungen.</p>
            </div>

            <div class="scenario-cards-grid" id="scenario-cards-grid">
                <!-- Scenario cards will be injected here -->
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" id="scenario-cancel-btn"
                    data-i18n="ui.buttons.cancel">Abbrechen</button>
            </div>
        </div>
    </div>

    <!-- Hero Selection Modal -->
    <div class="modal" id="hero-selection-modal">
        <div class="modal-content hero-selection-content">
            <div class="hero-selection-header">
                <h2 data-i18n="ui.titles.selectHero">Helden w√§hlen</h2>
                <p data-i18n="ui.labels.selectHeroDesc">W√§hle deinen Helden. Jeder Charakter hat eigene St√§rken und
                    ein einzigartiges Start-Deck.</p>
            </div>

            <div class="hero-cards-grid" id="hero-cards-grid">
                <!-- Hero cards will be injected here -->
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content settings-modal-content">
            <span class="modal-close" id="settings-close">&times;</span>
            <div class="settings-header">
                <h2>‚öôÔ∏è Einstellungen</h2>
            </div>
            <div class="settings-body">
                <div class="settings-tabs">
                    <button class="settings-tab-btn active" data-tab="general">Allgemein</button>
                    <button class="settings-tab-btn" data-tab="audio">Audio</button>
                    <button class="settings-tab-btn" data-tab="gameplay">Gameplay</button>
                </div>

                <div class="settings-tab-content active" id="settings-general">
                    <div class="setting-item">
                        <label for="setting-language">Sprache</label>
                        <select id="setting-language">
                            <option value="de">Deutsch</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label for="setting-theme">Design</label>
                        <select id="setting-theme">
                            <option value="classic">Klassisch (Pergament)</option>
                            <option value="dark">Dunkel (Glas)</option>
                            <option value="premium">Premium (Gold)</option>
                        </select>
                    </div>
                </div>

                <div class="settings-tab-content" id="settings-audio">
                    <div class="setting-item">
                        <label>Sound Effekte</label>
                        <label class="switch">
                            <input type="checkbox" id="setting-sound-enabled" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label for="setting-volume">Lautst√§rke</label>
                        <input type="range" id="setting-volume" min="0" max="100" value="100">
                    </div>
                </div>

                <div class="settings-tab-content" id="settings-gameplay">
                    <div class="setting-item">
                        <label for="setting-anim-speed">Animationsgeschwindigkeit</label>
                        <select id="setting-anim-speed">
                            <option value="1">Normal</option>
                            <option value="1.5">Schnell</option>
                            <option value="2">Sehr Schnell</option>
                            <option value="0">Sofort</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Tooltips anzeigen</label>
                        <label class="switch">
                            <input type="checkbox" id="setting-tooltips-enabled" checked>
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="button secondary-btn" id="settings-shortcuts-btn">‚å®Ô∏è Shortcuts</button>
                <button class="btn btn-primary" id="settings-save-btn">Speichern & Schlie√üen</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker registered:', registration.scope);

                        // Check for updates or initial install completion
                        registration.onupdatefound = () => {
                            const installingWorker = registration.installing;
                            installingWorker.onstatechange = () => {
                                if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    if (window.game) window.game.showToast(i18n.t('pwa.ready_offline'), 'info');
                                }
                            };
                        };
                    })
                    .catch((error) => {
                        console.warn('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>